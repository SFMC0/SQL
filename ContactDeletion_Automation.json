{"appVersion":"252.0.22","id":"5wuxggd53l","name":"My Definition - December 27, 2024 at 10:27:22 AM","version":1,"modelVersion":"6","references":{"automations/33d4624e-d980-4df1-b626-1a7d309a4022":[{"identifier":"scriptActivities/6373ff46-40e5-4b01-8bf6-365098df2ca8","relationship":"required"},{"identifier":"scriptActivities/ffbf8a3d-4e47-44f3-9595-6b2edc66beee","relationship":"required"},{"identifier":"queryActivities/ce06f7ef-0d37-40eb-b640-24c31f311f1f","relationship":"required"},{"identifier":"queryActivities/b34217a3-1cd5-4029-82eb-a5c5431190a0","relationship":"required"},{"identifier":"queryActivities/b21c7d75-a760-4db2-b76a-c3c58af70420","relationship":"required"},{"identifier":"verificationActivities/1bd02c03-f1c4-4642-ba5d-64ac1ff13374","relationship":"required"},{"identifier":"verificationActivities/6a0eba1c-350f-4e66-97d3-eab98519e2f7","relationship":"required"},{"identifier":"sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721","relationship":"required"},{"identifier":"sharedDataExtensions/dc227e73-8ad4-ed11-b85d-48df378332e5","relationship":"required"},{"identifier":"categories/270587","relationship":"required"}],"verificationActivities/6a0eba1c-350f-4e66-97d3-eab98519e2f7":[{"identifier":"sharedDataExtensions/dc227e73-8ad4-ed11-b85d-48df378332e5","relationship":"required"}],"scriptActivities/6373ff46-40e5-4b01-8bf6-365098df2ca8":[{"identifier":"sharedDataExtensions/0ac05aff-203a-ed11-b857-48df37833721","relationship":"required"},{"identifier":"categories/270579","relationship":"required"}],"scriptActivities/ffbf8a3d-4e47-44f3-9595-6b2edc66beee":[{"identifier":"sharedDataExtensions/0ac05aff-203a-ed11-b857-48df37833721","relationship":"required"},{"identifier":"categories/270579","relationship":"required"}],"queryActivities/ce06f7ef-0d37-40eb-b640-24c31f311f1f":[{"identifier":"sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721","relationship":"required"},{"identifier":"categories/270588","relationship":"required"}],"queryActivities/b34217a3-1cd5-4029-82eb-a5c5431190a0":[{"identifier":"sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721","relationship":"required"},{"identifier":"sharedDataExtensions/dc227e73-8ad4-ed11-b85d-48df378332e5","relationship":"required"},{"identifier":"categories/270588","relationship":"required"}],"queryActivities/b21c7d75-a760-4db2-b76a-c3c58af70420":[{"identifier":"sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721","relationship":"required"},{"identifier":"sharedDataExtensions/c067b9bf-8bd4-ed11-b85d-48df378332e5","relationship":"required"},{"identifier":"categories/270588","relationship":"required"}],"verificationActivities/1bd02c03-f1c4-4642-ba5d-64ac1ff13374":[{"identifier":"sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721","relationship":"required"}],"categories/270587":[{"identifier":"categories/270484","relationship":"required"}],"categories/270588":[{"identifier":"categories/270491","relationship":"required"}],"categories/270579":[{"identifier":"categories/342","relationship":"required"}],"categories/270484":[{"identifier":"categories/280","relationship":"required"}],"categories/270491":[{"identifier":"categories/269","relationship":"required"}],"sharedDataExtensions/dc227e73-8ad4-ed11-b85d-48df378332e5":[{"identifier":"categories/270586","relationship":"required"}],"sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721":[{"identifier":"categories/270586","relationship":"required"}],"sharedDataExtensions/c067b9bf-8bd4-ed11-b85d-48df378332e5":[{"identifier":"categories/270586","relationship":"required"}],"sharedDataExtensions/0ac05aff-203a-ed11-b857-48df37833721":[{"identifier":"categories/270586","relationship":"required"}],"categories/270586":[{"identifier":"categories/270489","relationship":"required"}],"categories/342":[],"categories/280":[],"categories/269":[],"categories/270489":[{"identifier":"categories/267","relationship":"required"}],"categories/267":[{"identifier":"categories/262","relationship":"required"}],"categories/262":[]},"input":[],"config":{"preserveCategories":true,"storeImagesAsReferences":false},"entities":{"assets":{},"attributeGroups":{},"attributeRelationships":{},"attributeSets":{},"automations":{"33d4624e-d980-4df1-b626-1a7d309a4022":{"issues":[],"originID":"33d4624e-d980-4df1-b626-1a7d309a4022","originEID":"","data":{"categoryId":"{{mcpm#/entities/categories/270587/data/id}}","description":"TMNT-4186","name":"SubscriberKeyDeletion","steps":[{"activities":[{"name":"{{mcpm#/entities/queryActivities/ce06f7ef-0d37-40eb-b640-24c31f311f1f/data/name}}","activityObjectId":"{{mcpm#/entities/queryActivities/ce06f7ef-0d37-40eb-b640-24c31f311f1f/data/id}}","objectTypeId":300,"displayOrder":0,"serializedObject":"<QueryDefinition xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://exacttarget.com/wsdl/partnerAPI\"><PartnerKey xsi:nil=\"true\" /><ObjectID>ce06f7ef-0d37-40eb-b640-24c31f311f1f</ObjectID><Name>QueryTopSubscriberKeysFromSubscribers</Name></QueryDefinition>"}],"annotation":"","name":""},{"activities":[{"name":"{{mcpm#/entities/sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721/data/name}}","activityObjectId":"{{mcpm#/entities/verificationActivities/1bd02c03-f1c4-4642-ba5d-64ac1ff13374/data/id}}","objectTypeId":1000,"displayOrder":0,"serializedObject":"<DataVerificationActivity xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://exacttarget.com/wsdl/partnerAPI\"><PartnerKey xsi:nil=\"true\" /><ObjectID>1bd02c03-f1c4-4642-ba5d-64ac1ff13374</ObjectID><Name>SubscriberKey_Current_Delete</Name></DataVerificationActivity>"}],"annotation":"","name":""},{"activities":[{"name":"{{mcpm#/entities/queryActivities/b34217a3-1cd5-4029-82eb-a5c5431190a0/data/name}}","activityObjectId":"{{mcpm#/entities/queryActivities/b34217a3-1cd5-4029-82eb-a5c5431190a0/data/id}}","objectTypeId":300,"displayOrder":0,"serializedObject":"<QueryDefinition xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://exacttarget.com/wsdl/partnerAPI\"><PartnerKey xsi:nil=\"true\" /><ObjectID>b34217a3-1cd5-4029-82eb-a5c5431190a0</ObjectID><Name>CheckForOnly</Name></QueryDefinition>"}],"annotation":"","name":""},{"activities":[{"name":"{{mcpm#/entities/sharedDataExtensions/dc227e73-8ad4-ed11-b85d-48df378332e5/data/name}}","activityObjectId":"{{mcpm#/entities/verificationActivities/6a0eba1c-350f-4e66-97d3-eab98519e2f7/data/id}}","objectTypeId":1000,"displayOrder":0,"serializedObject":"<DataVerificationActivity xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://exacttarget.com/wsdl/partnerAPI\"><PartnerKey xsi:nil=\"true\" /><ObjectID>6a0eba1c-350f-4e66-97d3-eab98519e2f7</ObjectID><Name>SubscriberKey_CountCheck</Name></DataVerificationActivity>"}],"annotation":"","name":""},{"activities":[{"name":"{{mcpm#/entities/queryActivities/b21c7d75-a760-4db2-b76a-c3c58af70420/data/name}}","activityObjectId":"{{mcpm#/entities/queryActivities/b21c7d75-a760-4db2-b76a-c3c58af70420/data/id}}","objectTypeId":300,"displayOrder":0,"serializedObject":"<QueryDefinition xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://exacttarget.com/wsdl/partnerAPI\"><PartnerKey xsi:nil=\"true\" /><ObjectID>b21c7d75-a760-4db2-b76a-c3c58af70420</ObjectID><Name>ArchiveDeletedSubscriberKeys</Name></QueryDefinition>"}],"annotation":"","name":""},{"activities":[{"name":"{{mcpm#/entities/scriptActivities/6373ff46-40e5-4b01-8bf6-365098df2ca8/data/name}}","activityObjectId":"{{mcpm#/entities/scriptActivities/6373ff46-40e5-4b01-8bf6-365098df2ca8/data/id}}","objectTypeId":423,"displayOrder":0,"serializedObject":"<SSJSActivity xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://exacttarget.com/wsdl/partnerAPI\"><PartnerKey xsi:nil=\"true\" /><ObjectID>6373ff46-40e5-4b01-8bf6-365098df2ca8</ObjectID><Name>DeleteContactsScript_V02</Name><CategoryId>0</CategoryId></SSJSActivity>"}],"annotation":"","name":""},{"activities":[{"name":"20 Minutes","activityObjectId":"01e2cb99-c1b6-4e27-ac2d-4ce4d30e8806","objectTypeId":467,"displayOrder":0,"serializedObject":"{\"duration\":20,\"durationUnits\":\"Minutes\"}"}],"annotation":"","name":""},{"activities":[{"name":"{{mcpm#/entities/scriptActivities/ffbf8a3d-4e47-44f3-9595-6b2edc66beee/data/name}}","activityObjectId":"{{mcpm#/entities/scriptActivities/ffbf8a3d-4e47-44f3-9595-6b2edc66beee/data/id}}","objectTypeId":423,"displayOrder":0,"serializedObject":"<SSJSActivity xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://exacttarget.com/wsdl/partnerAPI\"><PartnerKey xsi:nil=\"true\" /><ObjectID>ffbf8a3d-4e47-44f3-9595-6b2edc66beee</ObjectID><Name>Invoke_SubscriberKeyDeletion_Status_Monitoring_Pending_00</Name><CategoryId>0</CategoryId></SSJSActivity>"}],"annotation":"","name":"Invoke Contact Delete status check Automation"}],"startSource":{"typeId":1}}}},"categories":{"262":{"issues":[],"originID":"262","originEID":"","data":{"description":"","categoryType":"shared_data","parentId":0,"name":"Shared Items","editable":0,"extendable":0}},"267":{"issues":[],"originID":"267","originEID":"","data":{"description":"","categoryType":"shared_dataextension","parentId":"{{mcpm#/entities/categories/262/data/id}}","name":"Shared Data Extensions","editable":0,"extendable":1}},"269":{"issues":[],"originID":"269","originEID":"","data":{"description":"","categoryType":"queryactivity","parentId":0,"name":"Query","editable":0,"extendable":1}},"280":{"issues":[],"originID":"280","originEID":"","data":{"description":"","categoryType":"automations","parentId":0,"name":"my automations","editable":1,"extendable":1}},"342":{"issues":[],"originID":"342","originEID":"","data":{"description":"","categoryType":"SSJSActivity","parentId":0,"name":"Scripts","editable":0,"extendable":1}},"270484":{"issues":[],"originID":"270484","originEID":"","data":{"description":"","categoryType":"automations","parentId":"{{mcpm#/entities/categories/280/data/id}}","name":"UnsubscribeHeldSubscribers","editable":1,"extendable":1}},"270489":{"issues":[],"originID":"270489","originEID":"","data":{"description":"","categoryType":"shared_dataextension","parentId":"{{mcpm#/entities/categories/267/data/id}}","name":"UnsubscriberHeldSubscribers","editable":1,"extendable":1}},"270491":{"issues":[],"originID":"270491","originEID":"","data":{"description":"","categoryType":"queryactivity","parentId":"{{mcpm#/entities/categories/269/data/id}}","name":"UnsubscribeHeldSubscribers_WithOut","editable":1,"extendable":1}},"270579":{"issues":[],"originID":"270579","originEID":"","data":{"description":"","categoryType":"SSJSActivity","parentId":"{{mcpm#/entities/categories/342/data/id}}","name":"UnsubscribeHeldSubscribers","editable":1,"extendable":1}},"270586":{"issues":[],"originID":"270586","originEID":"","data":{"description":"","categoryType":"shared_dataextension","parentId":"{{mcpm#/entities/categories/270489/data/id}}","name":"_DeletionProcess","editable":1,"extendable":1}},"270587":{"issues":[],"originID":"270587","originEID":"","data":{"description":"","categoryType":"automations","parentId":"{{mcpm#/entities/categories/270484/data/id}}","name":"DeletionAutomation","editable":1,"extendable":1}},"270588":{"issues":[],"originID":"270588","originEID":"","data":{"description":"","categoryType":"queryactivity","parentId":"{{mcpm#/entities/categories/270491/data/id}}","name":"SubscriberKeyDeletion","editable":1,"extendable":1}}},"cloudPageCollections":{},"codeResources":{},"dataExtensions":{},"dataExtractActivities":{},"dataFilterDefinitions":{},"dataFilters":{},"eventDefinitions":{},"fileTransferActivities":{},"importActivities":{},"journeys":{},"journeyTemplates":{},"landingPages":{},"microsites":{},"micrositePages":{},"micrositePageVersions":{},"primaryLandingPages":{},"queryActivities":{"ce06f7ef-0d37-40eb-b640-24c31f311f1f":{"issues":[],"originID":"ce06f7ef-0d37-40eb-b640-24c31f311f1f","originEID":"","data":{"name":"QueryTopSubscriberKeysFromSubscribers","categoryId":"{{mcpm#/entities/categories/270588/data/id}}","description":"Top 35,000  Subscribers ","isFrozen":false,"queryText":"SELECT TOP 35000 \n    SubscriberKey\nFROM _Subscribers WITH (NOLOCK) \nWHERE SubscriberKey like '...%'\nORDER BY convert(varchar, DateJoined, 112) ASC","targetId":"{{mcpm#/entities/sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721/data/id}}","targetUpdateTypeId":0,"targetUpdateTypeName":"Overwrite"}},"b34217a3-1cd5-4029-82eb-a5c5431190a0":{"issues":[],"originID":"b34217a3-1cd5-4029-82eb-a5c5431190a0","originEID":"","data":{"name":"CheckForOnly","categoryId":"{{mcpm#/entities/categories/270588/data/id}}","description":"Count check from the current delete to make sure only the  Subscribers are sourcing to delete ","isFrozen":false,"queryText":"SELECT SubscriberKey\nFROM {{mcpm#/entities/sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721/data/namePrefix}}[{{mcpm#/entities/sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721/data/name}}]\nWHERE SubscriberKey not like '...%'","targetId":"{{mcpm#/entities/sharedDataExtensions/dc227e73-8ad4-ed11-b85d-48df378332e5/data/id}}","targetUpdateTypeId":0,"targetUpdateTypeName":"Overwrite"}},"b21c7d75-a760-4db2-b76a-c3c58af70420":{"issues":[],"originID":"b21c7d75-a760-4db2-b76a-c3c58af70420","originEID":"","data":{"name":"ArchiveDeletedSubscriberKeys","categoryId":"{{mcpm#/entities/categories/270588/data/id}}","description":"","isFrozen":false,"queryText":"SELECT \n    SubscriberKey, \n    GETDATE() AS [DateDeleted]\nFROM {{mcpm#/entities/sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721/data/namePrefix}}[{{mcpm#/entities/sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721/data/name}}]","targetId":"{{mcpm#/entities/sharedDataExtensions/c067b9bf-8bd4-ed11-b85d-48df378332e5/data/id}}","targetUpdateTypeId":2,"targetUpdateTypeName":"Append"}}},"registeredCustomActivities":{},"scriptActivities":{"6373ff46-40e5-4b01-8bf6-365098df2ca8":{"issues":[],"originID":"6373ff46-40e5-4b01-8bf6-365098df2ca8","originEID":"","data":{"name":"DeleteContactsScript_V02","script":"<script runat=\"server\">\n    Platform.Load(\"core\",\"1.1.5\");\n    /* -------------------------------------------------------------------------\n    Version: 1.1\n    Author:  \n    High level Overview: \n        1. Global Variables\n            1.1. Contact Deletion DE Key\n            1.2. REST API Authorization\n            1.3. Error Handling\n        2. Helper Functions\n            2.1. Debugging\n            2.2. Error handling\n        3. Main Script\n            3.1. REST API Authorization\n            3.2. Contact Deletion Process\n    -------------------------------------------------------------------------- */\n\n    /* ------------------------- 1. GLOBAL VARIABLES ------------------------- */\n\n    /* ------------------------ 1.1 Contact Deletion DE Key -------------------------- */\n\n    var contactDeletionDEKey = '25C4D576-E242-4B17-A74D-A03CEEA698AA';\n\n    /* ------------------------ 1.2 REST API Authorization --------------------------- */\n\n    var payload, endpoint, response;\n    var TenantEndpoint = ''\n    var clientID = '';\n    var clientSecret = '';\n    var contentType = 'application/json';\n    var debugging = false;\n\n    /* ------------------------ 1.3 Error Handling --------------------------- */\n\n    var errorDE = '6A0BA64D-9E4C-42B8-9386-ADDB3F82CCE9';\n    var automationName = '64e50998-cb04-1536-0510-f19c5cd31e0e : SubscriberKeyDeletion';\n\n    /* ----------------------------------------------------------------------- */\n    /* ------------------------- 2. HELPER FUNCTIONS ------------------------- */\n    /* ----------------------------------------------------------------------- */\n\n    /* --------------------------- 2.1. Debugging ---------------------------- */\n    /**\n     * @function debugValue\n     * @description Outputs provided description and SSJS value to front-end in a type-safe & consistent way\n     * @param {string} description - Describes meaning of the second parameter in the output\n    * @param {*} value - The value that needs to be debugged\n    */\n    function debugValue(description, value) {\n        Write(description + ': ' + (typeof value == 'object' ? Stringify(value) : value) + '<br><br>');\n    };\n\n    /* -------------------------- 2.2. Error handling ------------------------ */\n\n    /**\n     * @function handleError\n     * @description Adds the error with context to error logging Data Extension and redirects to an error page.\n     * @param {Object} error - The caught error object. It can come from the try/catch block or be manually created.\n    * @param {string} error.message - First error key stores a short error message describing the issue.\n    * @param {string} error.description - Second error key stores detailed error path helping with root cause analysis\n    */\n    function handleError(error) {\n        if (debugging) {\n        debugValue('Found error', error);\n        } else {\n        Platform.Function.InsertData(errorDE, ['ID', 'ErrorSource', 'ErrorMessage', 'ErrorDescription'], [GUID(), automationName, error.message, error.description]);\n        };\n    };\n\n    /* ----------------------------------------------------------------------- */\n    /* --------------------------- 3. MAIN SCRIPT ---------------------------- */\n    /* ----------------------------------------------------------------------- */\n\n    /* ------------------- 3.1. REST API Authorization --------------------- */\n\n    endpoint = 'https://' + TenantEndpoint + '.auth.marketingcloudapis.com/v2/token';\n    payload = {\n        client_id: clientID,\n    client_secret: clientSecret,\n    grant_type: 'client_credentials'\n    };\n    if (debugging) debugValue('Payload', payload);\n\n    try {\n        response = HTTP.Post(endpoint, contentType, Stringify(payload));\n    } catch (error) {\n        handleError(error);\n    }\n    var accessToken = Platform.Function.ParseJSON(response['Response'][0]).access_token;\n    if (debugging) debugValue('AccessToken', accessToken);\n\n    /* ------------------- 3.2. Contact Deletion Process --------------------- */\n\n    endpoint = 'https://' + TenantEndpoint + '.rest.marketingcloudapis.com/contacts/v1/contacts/actions/delete?type=listReference';\n    payload = {\n        deleteOperationType: 'ContactAndAttributes',\n    targetList: {\n        listType: {listTypeID: 3 },\n    listKey: contactDeletionDEKey\n        },\n    deleteListWhenCompleted: false,\n    deleteListContentsWhenCompleted: true\n    };\n    var headerNames = ['Authorization'];\n    var headerValues = ['Bearer ' + accessToken];\n\n    try {\n        response = HTTP.Post(endpoint, contentType, Stringify(payload), headerNames, headerValues);\n        var delobj = Platform.Function.ParseJSON(response.Response[0]);\n        //Write(Stringify(delobj));\n        if (delobj.hasErrors == false) {\n            /* DE -  API Delete log to capture the number of contact deleted on a date */\n            var de = DataExtension.Init(\"{{mcpm#/entities/sharedDataExtensions/0ac05aff-203a-ed11-b857-48df37833721/data/customerKey}}\");\n            var SFMC_operationID = delobj.operationID;\n            var Delete_Operation_Status = 'Pending';\n            de.Rows.Add({\n                SFMC_operationID:delobj.operationID,\n                DeletedRecordCount:delobj.targetListInformation.rowCount,\n                Delete_Operation_Status:Delete_Operation_Status,\n                RequestInitiatedDateTime:delobj.responseDateTime\n            });\n        }\n\n    else if (debugging) debugValue('Response', response);\n\n    }\n        catch (error) {\n            handleError(error);\n        }\n</script>","categoryId":"{{mcpm#/entities/categories/270579/data/id}}","description":"This script deletes the contacts and updates the Details of the delete operation to a DE "}},"ffbf8a3d-4e47-44f3-9595-6b2edc66beee":{"issues":[{"type":"ENTITY_NOT_FOUND","level":"WARNING","sourceJobType":"PACKAGE","entity":{"entityType":"dataExtensions","retrievalProperty":"customerKey","value":"APIDeleteLog","parentPath":"$['script']:I4255"},"entityParent":{"entityType":"scriptActivities","retrievalProperty":"id","value":"ffbf8a3d-4e47-44f3-9595-6b2edc66beee","parentPath":"$['steps'][7]['activities'][0]['activityObjectId']","locationInformation":{"activityName":"Invoke_SubscriberKeyDeletion_Status_Monitoring_Pending_00","dependencyContentType":"AUTOMATION_ACTIVITY","stepNumber":8,"parentAutomationName":"SubscriberKeyDeletion"}},"depPath":[{"entityType":"automations","retrievalProperty":"id","value":"33d4624e-d980-4df1-b626-1a7d309a4022","parentPath":"root"},{"entityType":"scriptActivities","retrievalProperty":"id","value":"ffbf8a3d-4e47-44f3-9595-6b2edc66beee","parentPath":"$['steps'][7]['activities'][0]['activityObjectId']","locationInformation":{"activityName":"Invoke_SubscriberKeyDeletion_Status_Monitoring_Pending_00","dependencyContentType":"AUTOMATION_ACTIVITY","stepNumber":8,"parentAutomationName":"SubscriberKeyDeletion"}}]}],"originID":"ffbf8a3d-4e47-44f3-9595-6b2edc66beee","originEID":"","data":{"name":"Invoke_SubscriberKeyDeletion_Status_Monitoring_Pending_00","script":"<script runat=\"server\">\nPlatform.Load(\"core\",\"1.1.5\");\n    /* -------------------------------------------------------------------------\n    Version: 1.0\n    Author:  \n    High level Overview: \n        1. Global Variables\n            1.1. Contact Deletion DE Key\n            1.2. REST API Authorization\n            1.3. Error Handling\n        2. Helper Functions\n            2.1. Debugging\n            2.2. Error handling\n        3. Main Script\n            3.1. REST API Authorization\n            3.2. Contact Deletion Process\n    -------------------------------------------------------------------------- */\n\n    /* ------------------------- 1. GLOBAL VARIABLES ------------------------- */\n\n    /* ------------------------ 1.1 Contact Deletion DE Key -------------------------- */\n\n    var contactDeletionDEKey = '25C4D576-E242-4B17-A74D-A03CEEA698AA';\n\n    /* ------------------------ 1.2 REST API Authorization --------------------------- */\n\n    var payload, endpoint, response;\n    var TenantEndpoint = ''\n    var clientID = '';\n    var clientSecret = '';\n    var contentType = 'application/json';\n    var debugging = false;\n\n    /* ------------------------ 1.3 Error Handling --------------------------- */\n\n    var errorDE = '6A0BA64D-9E4C-42B8-9386-ADDB3F82CCE9';\n    var automationName = '64e50998-cb04-1536-0510-f19c5cd31e0e'; /*  SubscriberKeyDeletion */\n\n    /* ----------------------------------------------------------------------- */\n    /* ------------------------- 2. HELPER FUNCTIONS ------------------------- */\n    /* ----------------------------------------------------------------------- */\n\n    /* --------------------------- 2.1. Debugging ---------------------------- */\n    /**\n     * @function debugValue\n     * @description Outputs provided description and SSJS value to front-end in a type-safe & consistent way\n     * @param {string} description - Describes meaning of the second parameter in the output\n    * @param {*} value - The value that needs to be debugged\n    */\n    function debugValue(description, value) {\n        Write(description + ': ' + (typeof value == 'object' ? Stringify(value) : value) + '<br><br>');\n    };\n\n    /* -------------------------- 2.2. Error handling ------------------------ */\n\n    /**\n     * @function handleError\n     * @description Adds the error with context to error logging Data Extension and redirects to an error page.\n     * @param {Object} error - The caught error object. It can come from the try/catch block or be manually created.\n    * @param {string} error.message - First error key stores a short error message describing the issue.\n    * @param {string} error.description - Second error key stores detailed error path helping with root cause analysis\n    */\n    function handleError(error) {\n        if (debugging) {\n        debugValue('Found error', error);\n        } else {\n        Platform.Function.InsertData(errorDE, ['ID', 'ErrorSource', 'ErrorMessage', 'ErrorDescription'], [GUID(), automationName, error.message, error.description]);\n        };\n    };\n\n    /* ----------------------------------------------------------------------- */\n    /* --------------------------- 3. MAIN SCRIPT ---------------------------- */\n    /* ----------------------------------------------------------------------- */\n\n    /* ------------------- 3.1. REST API Authorization --------------------- */\n\n    endpoint = 'https://' + TenantEndpoint + '.auth.marketingcloudapis.com/v2/token';\n    payload = {\n        client_id: clientID,\n    client_secret: clientSecret,\n    grant_type: 'client_credentials'\n    };\n    if (debugging) debugValue('Payload', payload);\n\n    try {\n        response = HTTP.Post(endpoint, contentType, Stringify(payload));\n    } catch (error) {\n        handleError(error);\n    }\n    var accessToken = Platform.Function.ParseJSON(response['Response'][0]).access_token;\n    if (debugging) debugValue('AccessToken', accessToken);\n\n    /* ------------------- 3.2. Contact Deletion Process Monitoring --------------------- */\n    try {\n    var headerNames = ['Authorization'];\n    var headerValues = ['Bearer ' + accessToken];\n    var DeleteOperationDE = DataExtension.Init(\"APIDeleteLog\");\n    var data = DeleteOperationDE.Rows.Lookup([\"Delete_Operation_Status\"], [\"Pending\"], 1, \"RequestInitiatedDateTime DESC\");\n    var length = data.length();\n    if (length == 0)\n      {\n        var data = DeleteOperationDE.Rows.Lookup([\"Delete_Operation_Status\"], [\"Processing\"], 1, \"RequestInitiatedDateTime DESC\");\n        var length1 = data.length();\n         if (length1 == 0) {\n           var data = DeleteOperationDE.Rows.Lookup([\"Delete_Operation_Status\"], [\"Completed\"], 1, \"RequestInitiatedDateTime DESC\");\n         }   \n        var length2 = data.length();\n         if (length2 == 0) {\n           var data = DeleteOperationDE.Rows.Lookup([\"Delete_Operation_Status\"], [\"Failed\"], 1, \"RequestInitiatedDateTime DESC\");\n         }   \n                \n     }\n   var Delete_operationID= Platform.Function.ParseJSON(data[0].SFMC_operationID);\n    var delete_operation_endpoint = 'https://' + TenantEndpoint + '.rest.marketingcloudapis.com/contacts/v1/contacts/actions/delete/status?operationID=' + Delete_operationID ;\n    response = HTTP.Get(delete_operation_endpoint, headerNames, headerValues);\n       // Write (Stringify(response)); \n    var ResponseJson = Platform.Function.ParseJSON(response.Content);\n        //Write (Stringify(ResponseJson)); \n     var cachingStr = ResponseJson.toString();\n     var cacheresult = cachingStr.indexOf(\"backgroundOperationsSummary\");    \n      \n      if(cacheresult >= -1) {\n        var SFMC_operationID_status = ResponseJson.backgroundOperationsSummary[0].backgroundOperationStatusID;\n            //Write(SFMC_operationID_status);\n      }\n      else {\n        var SFMC_operationID_status = \"Pending\";\n        //Write(SFMC_operationID_status);\n      }\n          \n    // var SFMC_operationID_status = ResponseJson.backgroundOperationsSummary[0].backgroundOperationStatusID;\n\n      \n   var rows = Platform.Function.UpsertDE(\"{{mcpm#/entities/sharedDataExtensions/0ac05aff-203a-ed11-b857-48df37833721/data/name}}\",[\"SFMC_operationID\"],[Delete_operationID],[\"Delete_Operation_Status\", \"LastCheckDateTime\"],[SFMC_operationID_status, Now()]);\n\n\n        if ( SFMC_operationID_status == \"Completed\" || SFMC_operationID_status == \"Failed\" ) {\n          \n            var api = new Script.Util.WSProxy();\n            var action = \"Start\";\n            api.setClientId({ \"ID\": '7220265'}); // Set ClientID if you need to\n    \n            //Automation Name: SubscriberKeyDeletion_Status_Monitoring_Pending_01\n            var props = {CustomerKey: \"73961330-4fc9-4bde-b7da-0728aa6a9750\"};\n            \n            var opts = {};\n            var results = api.performItem(\"Automation\", props, action, opts);\n          \n        }\n      else {\n\n            //Invoke Monitor Automation\n            var api = new Script.Util.WSProxy();\n            var action = \"Start\";\n            api.setClientId({ \"ID\": '7220265'}); // Set ClientID if you need to\n    \n            //Automation Name: SubscriberKeyDeletion_Status_Monitoring\n            var props = {CustomerKey: \"380e08a5-97ca-4bae-88b5-8ae29518d80b\"};\n            var opts = {};\n            var results = api.performItem(\"Automation\", props, action, opts);\n          \n      }\n        \n    } catch (error) {\n    Write(\"<br>error: \" + Stringify(error));\n}\n  \n</script>","categoryId":"{{mcpm#/entities/categories/270579/data/id}}","description":""}}},"sendDefinitions":{},"sharedDataExtensions":{"dc227e73-8ad4-ed11-b85d-48df378332e5":{"issues":[{"type":"UNSUPPORTED_FUNCTIONALITY","level":"WARNING","sourceJobType":"PACKAGE","functionality":"SHARED_DE"}],"originID":"dc227e73-8ad4-ed11-b85d-48df378332e5","originEID":"","data":{"categoryId":"{{mcpm#/entities/categories/270586/data/id}}","dataRetentionProperties":{"dataRetentionPeriodUnitOfMeasure":6,"dataRetentionPeriodLength":3,"isDeleteAtEndOfRetentionPeriod":false,"isResetRetentionPeriodOnImport":false,"isRowBasedRetention":true,"rowBasedThreshold":2147483647},"description":"","isFieldAdditionAllowed":true,"isFieldModificationAllowed":true,"isObjectDeletable":true,"isSendable":false,"isTestable":false,"name":"SubscriberKey_CountCheck","fields":[{"description":"","isHidden":false,"isInheritable":true,"isOverridable":true,"isNullable":false,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":500,"masktype":"None","mustOverride":false,"name":"SubscriberKey","ordinal":1,"type":"Text"}]}},"70fac1d5-173a-ed11-b857-48df37833721":{"issues":[{"type":"UNSUPPORTED_FUNCTIONALITY","level":"WARNING","sourceJobType":"PACKAGE","functionality":"SHARED_DE"}],"originID":"70fac1d5-173a-ed11-b857-48df37833721","originEID":"","data":{"categoryId":"{{mcpm#/entities/categories/270586/data/id}}","dataRetentionProperties":{"dataRetentionPeriodUnitOfMeasure":5,"dataRetentionPeriodLength":6,"isDeleteAtEndOfRetentionPeriod":false,"isResetRetentionPeriodOnImport":false,"isRowBasedRetention":true,"rowBasedThreshold":2147483647},"description":"TMNT-4186","isFieldAdditionAllowed":true,"isFieldModificationAllowed":true,"isObjectDeletable":true,"isSendable":true,"isTestable":false,"name":"SubscriberKey_Current_Delete","sendableCustomObjectField":"SubscriberKey","sendableSubscriberField":"_SubscriberKey","fields":[{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":false,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":254,"masktype":"None","mustOverride":false,"name":"SubscriberKey","ordinal":1,"type":"Text"}]}},"c067b9bf-8bd4-ed11-b85d-48df378332e5":{"issues":[{"type":"UNSUPPORTED_FUNCTIONALITY","level":"WARNING","sourceJobType":"PACKAGE","functionality":"SHARED_DE"}],"originID":"c067b9bf-8bd4-ed11-b85d-48df378332e5","originEID":"","data":{"categoryId":"{{mcpm#/entities/categories/270586/data/id}}","dataRetentionProperties":{"dataRetentionPeriodUnitOfMeasure":6,"dataRetentionPeriodLength":3,"isDeleteAtEndOfRetentionPeriod":false,"isResetRetentionPeriodOnImport":false,"isRowBasedRetention":true,"rowBasedThreshold":2147483647},"description":"","isFieldAdditionAllowed":true,"isFieldModificationAllowed":true,"isObjectDeletable":true,"isSendable":false,"isTestable":false,"name":"SubscriberKey_Archive","fields":[{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":false,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":500,"masktype":"None","mustOverride":false,"name":"SubscriberKey","ordinal":0,"type":"Text"},{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":false,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"masktype":"None","mustOverride":false,"name":"DateDeleted","ordinal":1,"type":"Date"}]}},"0ac05aff-203a-ed11-b857-48df37833721":{"issues":[{"type":"UNSUPPORTED_FUNCTIONALITY","level":"WARNING","sourceJobType":"PACKAGE","functionality":"SHARED_DE"}],"originID":"0ac05aff-203a-ed11-b857-48df37833721","originEID":"","data":{"categoryId":"{{mcpm#/entities/categories/270586/data/id}}","dataRetentionProperties":{"dataRetentionPeriodUnitOfMeasure":6,"dataRetentionPeriodLength":3,"isDeleteAtEndOfRetentionPeriod":false,"isResetRetentionPeriodOnImport":false,"isRowBasedRetention":true,"rowBasedThreshold":2147483647},"description":"","isFieldAdditionAllowed":true,"isFieldModificationAllowed":true,"isObjectDeletable":true,"isSendable":false,"isTestable":false,"name":"APIDeleteLog","fields":[{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":false,"isPrimaryKey":true,"isReadOnly":false,"isTemplateField":false,"length":254,"masktype":"None","mustOverride":false,"name":"SFMC_operationID","ordinal":7,"type":"Text"},{"description":"","isHidden":false,"isInheritable":true,"isOverridable":true,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"masktype":"None","mustOverride":false,"name":"DeletedRecordCount","ordinal":8,"type":"Number"},{"description":"","isHidden":false,"isInheritable":true,"isOverridable":true,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":254,"masktype":"None","mustOverride":false,"name":"Delete_Operation_Status","ordinal":10,"type":"Text"},{"description":"","isHidden":false,"isInheritable":true,"isOverridable":true,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"masktype":"None","mustOverride":false,"name":"RequestInitiatedDateTime","ordinal":13,"type":"Date"},{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"masktype":"None","mustOverride":false,"name":"LastCheckDateTime","ordinal":14,"type":"Date"}]}}},"siteMapVersions":{},"subscriberLists":{},"verificationActivities":{"6a0eba1c-350f-4e66-97d3-eab98519e2f7":{"issues":[{"type":"UNSUPPORTED_FUNCTIONALITY","level":"INFO","sourceJobType":"PACKAGE","functionality":"VERIFICATION_ACTIVITY_EMAIL_ON_FAILURE"}],"originID":"6a0eba1c-350f-4e66-97d3-eab98519e2f7","originEID":"","data":{"name":"","notificationEmailMessage":"","shouldStopOnFailure":true,"targetObjectId":"{{mcpm#/entities/sharedDataExtensions/dc227e73-8ad4-ed11-b85d-48df378332e5/data/id}}","value1":0,"value2":0,"verificationType":"IsGreaterThan"}},"1bd02c03-f1c4-4642-ba5d-64ac1ff13374":{"issues":[{"type":"UNSUPPORTED_FUNCTIONALITY","level":"INFO","sourceJobType":"PACKAGE","functionality":"VERIFICATION_ACTIVITY_EMAIL_ON_FAILURE"}],"originID":"1bd02c03-f1c4-4642-ba5d-64ac1ff13374","originEID":"","data":{"name":"","notificationEmailMessage":"\nThere are No ... Prefix SubscriberKeys to Delete in the Source DE. \n\nAutomation Name# SubscriberKeyDeletion \n\n","shouldStopOnFailure":true,"targetObjectId":"{{mcpm#/entities/sharedDataExtensions/70fac1d5-173a-ed11-b857-48df37833721/data/id}}","value1":0,"value2":0,"verificationType":"IsEqualTo"}}}},"selectedEntities":{"assets":[],"attributeGroups":[],"automations":["33d4624e-d980-4df1-b626-1a7d309a4022"],"cloudPageCollections":[],"dataExtensions":[],"journeys":[],"journeyTemplates":[],"sharedDataExtensions":[]}}